<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Search</title>
        {% load static %}
        <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    </head>
    <body>
        <div id="loading-indicator" class="loading-indicator hidden">
            <div class="saucer">üõ∏</div>
        </div>
        <div class="container">
            <form method="GET"
                  action=""
                  class="search-form"
                  onsubmit="showLoadingIndicator()">
                <input type="text" name="q" value="{{ query }}" placeholder="Search...">
                <select name="field">
                    <option value="text_content"
                            {% if field == 'text_content' %}selected{% endif %}>Text Content</option>
                    <option value="title" {% if field == 'title' %}selected{% endif %}>Title</option>
                    <option value="location" {% if field == 'location' %}selected{% endif %}>Location</option>
                    <option value="witnesses" {% if field == 'witnesses' %}selected{% endif %}>Witnesses</option>
                </select>
                <button type="submit">Search</button>
            </form>
            {% if results %}
                <h2>{{ result_count }} search results for "{{ query }}"</h2>
                <div class="container">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Title</th>
                                <th>Summary</th>
                                <th>Location</th>
                                <th>Type</th>
                                <th>Witnesses</th>
                                <th>Matches</th>
                                <th>PDF</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in results %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>
                                        <a href="{{ result.get_absolute_url }}">{{ result.title }}</a>
                                    </td>
                                    <td>{{ result.summary }}</td>
                                    <td>{{ result.location }} üìç</td>
                                    <td>{{ result.type }} üîç</td>
                                    <td>{{ result.witnesses }} üïµÔ∏è‚Äç‚ôÇÔ∏è</td>
                                    <td>
                                        {% if result.content %}
                                            <p class="highlighted-content">{{ result.content|safe }}</p>
                                        {% else %}
                                            No content available.
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ result.get_pdf_url }}">View PDF</a> üìÑ
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="no-results">No results found.</p>
                {% endif %}
            </div>
        </div>
        <script>
        function showLoadingIndicator() {
            document.getElementById('loading-indicator').classList.remove('hidden');
        }
        // Hide loading indicator when page is fully loaded
        window.addEventListener('load', function() {
            document.getElementById('loading-indicator').classList.add('hidden');
        });
        </script>
    </body>
</html>
